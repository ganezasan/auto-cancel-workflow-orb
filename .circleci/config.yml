version: 2.1
orbs:
  auto-cancel: ganezasan/auto-cancel-workflow@dev:first
  orb-tools: circleci/orb-tools@7.3.0

executors:
  default:
    docker:
      - image: alpine:latest
jobs:
  job-1:
    executor: default
    steps:
      - run: sleep 120
  job-2:
    executor: default
    steps:
      - run: sleep 60
  failed-job:
    executor: default
    steps:
      - run: sleep 30 && exit 1

workflows:
  version: 2
  a-job-failed:
    jobs:
      - hold:
          type: approval
      - job-1:
          requires:
            - hold
      - job-2:
          requires:
            - hold
      - failed-job:
          requires:
            - hold
      - auto-cancel/auto-cancel:
          requires:
            - hold
          api_token: CIRCLE_TOKEN
          interval_seconds: 10
  all-jobs-success:
    jobs:
      - hold:
          type: approval
      - job-1:
          requires:
            - hold
      - job-2:
          requires:
            - hold
      - auto-cancel/auto-cancel:
          requires:
            - hold
          api_token: CIRCLE_TOKEN
          interval_seconds: 10
  lint_pack-validate_publish-dev:
    jobs:
      - orb-tools/lint
      - orb-tools/publish-dev:
          checkout: true
          attach-workspace: false
          orb-name: ganezasan/auto-cancel-workflow
          orb-path: orb.yml
          requires:
            - orb-tools/lint
      - orb-tools/trigger-integration-workflow:
          name: trigger-integration-dev
          ssh-fingerprints: b1:b4:6a:3d:2d:1c:63:4f:fd:92:78:e1:0f:87:d3:37
          requires:
            - orb-tools/publish-dev
